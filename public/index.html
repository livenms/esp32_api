<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Robot Web Controller</title>
<script src="https://cdn.jsdelivr.net/npm/nipplejs@0.9.0/dist/nipplejs.min.js"></script>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Robot Web Controller</h1>

<div id="controls">
    <div id="joystick-zone"></div>
    <label>Linear:
        <input id="linear-slider" type="range" min="-1" max="1" step="0.01" value="0">
    </label>
    <label>Angular:
        <input id="angular-slider" type="range" min="-1" max="1" step="0.01" value="0">
    </label>
    <button onclick="sendCommand(0,0)">Stop</button>
</div>

<script>
const apiUrl = "/cmd_vel";

function sendCommand(linear, angular) {
    fetch(apiUrl, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({linear, angular})
    }).then(res => res.json())
      .then(console.log)
      .catch(console.error);
}

// Joystick
const joystick = nipplejs.create({
    zone: document.getElementById('joystick-zone'),
    mode:'static',
    position:{left:'50%', top:'50%'},
    color:'blue',
    size:150
});

joystick.on('move', (evt, data) => {
    if(data.distance){
        const angleRad = data.angle.radian;
        let linear = Math.cos(angleRad)*data.distance/100;
        let angular = -Math.sin(angleRad)*data.distance/100;
        linear = Math.max(Math.min(linear,1),-1);
        angular = Math.max(Math.min(angular,1),-1);
        sendCommand(linear, angular);
        document.getElementById('linear-slider').value = linear;
        document.getElementById('angular-slider').value = angular;
    }
});

joystick.on('end', () => sendCommand(0,0));

// Slider control
document.getElementById('linear-slider').addEventListener('input', ()=>{
    sendCommand(parseFloat(document.getElementById('linear-slider').value),
                parseFloat(document.getElementById('angular-slider').value));
});
document.getElementById('angular-slider').addEventListener('input', ()=>{
    sendCommand(parseFloat(document.getElementById('linear-slider').value),
                parseFloat(document.getElementById('angular-slider').value));
});
</script>
</body>
</html>
